{"version":3,"sources":["webpack:///src/app/messaging/message-session/message-session.page.scss","webpack:///src/app/messaging/message-session/message-session.page.ts","webpack:///src/app/messaging/message-session/message-session-routing.module.ts","webpack:///src/app/messaging/message-session/message-session.page.html","webpack:///src/app/messaging/message-session/message-session.module.ts"],"names":["Drafty","isSizedEvent","e","width","undefined","height","MessageSessionPage","sessionsManagerService","imService","navController","alert","env","media","file","platform","ref","modalController","getName","isTyping","isOnline","form","sendInput","detach","leaveChatPage","hasActiveIMTopic","presentError","returnUrlIfNoActiveIMTopic","then","url","navigateRoot","title","IMPeerUser","first_name","item","index","isImage","session","somethingPendingUpdated","pipe","subscribe","result","detectChanges","isUserOnline","addOnlineObserver","isTypingSubject","messageAddedToStart","content","getScrollElement","el","scrollY","oldScrollHeight","scrollHeight","oldScrollTop","scrollTop","heightObservable","observer","heightIntervalHandle","setInterval","next","complete","clearInterval","newScrollTop","infiniteScroll","messageGotDirty","dirty","vitrualScroll","checkRange","messageAddedToEnd","noteReceived","messages","noteRead","clearTimeout","scrollToBottomTimeOut","positionForItem","setTimeout","scrollToBottom","disabled","noMoreMessages","yes","notifyEnteredChatPage","props","providerPerspective","isUser","openedFromSessionChat","presentModal","isSessionChat","isEnded","isActive","subtitle","getStateString","record","seq","event","getMessagesPage","selector","template","changeDetection","OnPush","routes","path","component","MessageSessionPageRoutingModule","imports","forChild","exports","MessageSessionPageModule","declarations"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAe;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACgCf,UAAMA,MAAM,GAAG,mDAAOA,MAAtB;;AAMA,eAASC,YAAT,CAAsBC,CAAtB,EAA4B;AAC1B,eAAOA,CAAC,IAAIA,CAAC,CAACC,KAAF,KAAYC,SAAjB,IAA8BF,CAAC,CAACG,MAAF,KAAaD,SAAlD;AACD;;UAQYE,kBAAkB;AAe7B,oCACSC,sBADT,EAESC,SAFT,EAGUC,aAHV,EAIUC,KAJV,EAKSC,GALT,EAMUC,KANV,EAOUC,IAPV,EAQUC,QARV,EASUC,GATV,EAUUC,eAVV,EAU0C;AAAA;;AATjC,eAAAT,sBAAA,GAAAA,sBAAA;AACA,eAAAC,SAAA,GAAAA,SAAA;AACC,eAAAC,aAAA,GAAAA,aAAA;AACA,eAAAC,KAAA,GAAAA,KAAA;AACD,eAAAC,GAAA,GAAAA,GAAA;AACC,eAAAC,KAAA,GAAAA,KAAA;AACA,eAAAC,IAAA,GAAAA,IAAA;AACA,eAAAC,QAAA,GAAAA,QAAA;AACA,eAAAC,GAAA,GAAAA,GAAA;AACA,eAAAC,eAAA,GAAAA,eAAA;AAhBV,eAAAC,OAAA,GAAU,kDAAKA,OAAf;AAGA,eAAAC,QAAA,GAAW,KAAX;AACA,eAAAC,QAAA,GAAW,KAAX;AAcE,eAAKC,IAAL,GAAY,IAAI,yDAAJ,CAAc;AACxBC,qBAAS,EAAE,IAAI,2DAAJ,CAAgB,EAAhB;AADa,WAAd,CAAZ;AAGA,eAAKN,GAAL,CAASO,MAAT,GALwC,CAMxC;AACD;;AAhC4B;AAAA;AAAA,6CAiCV;AACjB,iBAAKf,sBAAL,CAA4BgB,aAA5B,GADiB,CAEjB;AACA;AACD;AArC4B;AAAA;AAAA,6CAsCV,CAAE;AAtCQ;AAAA;AAAA,qCAuClB;AAAA;;AACT,gBAAI,CAAC,KAAKhB,sBAAL,CAA4BiB,gBAAjC,EAAmD;AACjD,mBAAKd,KAAL,CAAWe,YAAX,CAAwB,wBAAxB;AACA,mBAAKlB,sBAAL,CAA4BmB,0BAA5B,GAAyDC,IAAzD,CAA8D,UAACC,GAAD,EAAS;AACrE,qBAAI,CAACnB,aAAL,CAAmBoB,YAAnB,CAAgC,CAACD,GAAD,CAAhC;AACD,eAFD;AAGD,aALD,MAKO;AACL,mBAAKE,KAAL,GAAa,KAAKvB,sBAAL,CAA4BwB,UAA5B,CAAuCC,UAApD;AACD;AACF;AAhD4B;AAAA;AAAA,qCAkDlBC,IAlDkB,EAkDZC,KAlDY,EAkDL;AACtB,gBAAID,IAAI,CAACE,OAAT,EAAkB;AAChB,qBAAO,GAAP;AACD;;AAED,mBAAO,EAAP;AACA,mBAAO,EAAP;AACD;AAzD4B;AAAA;AAAA,4CA0DX,CAChB;AACD;AA5D4B;AAAA;AAAA,4CA6Dd;AAAA;;AACb,iBAAKC,OAAL,GAAe,KAAK7B,sBAAL,CAA4B6B,OAA3C;AACA,iBAAKzB,GAAL,CAAS0B,uBAAT,CACGC,IADH,CACQ,8EAAe,IAAf,CADR,EAEGC,SAFH,CAEa,UAACC,MAAD,EAAY;AACrB,oBAAI,CAACzB,GAAL,CAAS0B,aAAT;AACD,aAJH;;AAKA,gBAAI,KAAKlC,sBAAL,CAA4BiB,gBAAhC,EAAkD;AAChD,mBAAKL,QAAL,GAAgB,KAAKZ,sBAAL,CAA4BmC,YAA5B,CACd,KAAKnC,sBAAL,CAA4BwB,UADd,CAAhB;AAGA,mBAAKxB,sBAAL,CACGoC,iBADH,CACqB,KAAKpC,sBAAL,CAA4BwB,UADjD,EAEGO,IAFH,CAEQ,8EAAe,IAAf,CAFR,EAGGC,SAHH,CAGa,UAACC,MAAD,EAAY;AACrB,sBAAI,CAACrB,QAAL,GAAgBqB,MAAhB;;AACA,sBAAI,CAACzB,GAAL,CAAS0B,aAAT;AACD,eANH;AAOD;;AAED,iBAAKjC,SAAL,CAAeoC,eAAf,CACGN,IADH,CACQ,8EAAe,IAAf,CADR,EAEGC,SAFH,CAEa,UAACC,MAAD,EAAY;AACrB,oBAAI,CAACtB,QAAL,GAAgBsB,MAAhB;;AACA,oBAAI,CAACzB,GAAL,CAAS0B,aAAT;AACD,aALH;AAMA,iBAAKjC,SAAL,CAAeqC,mBAAf,CACGP,IADH,CACQ,qEAAa,GAAb,CADR,EAC2B,8EAAe,IAAf,CAD3B,EAEGC,SAFH,CAEa,UAACL,KAAD,EAAW;AACpB,oBAAI,CAACY,OAAL,CAAaC,gBAAb,GAAgCpB,IAAhC,CAAqC,UAACqB,EAAD,EAAQ;AAC3C,sBAAI,CAACjC,GAAL,CAAS0B,aAAT;;AACA,sBAAI,CAACK,OAAL,CAAaG,OAAb,GAAuB,KAAvB;AACA,oBAAIC,eAAe,GAAGF,EAAE,CAACG,YAAzB;AACA,oBAAIC,YAAY,GAAGJ,EAAE,CAACK,SAAtB;AACA,oBAAIC,gBAAgB,GAAG,IAAI,gDAAJ,CAAe,UAACC,QAAD,EAAc;AAClD,wBAAI,CAACC,oBAAL,GAA4BC,WAAW,CAAC,YAAM;AAC5C,wBAAIT,EAAE,CAACG,YAAH,IAAmBD,eAAvB,EAAwC;AACtCK,8BAAQ,CAACG,IAAT,CAAcV,EAAE,CAACG,YAAjB;AACAI,8BAAQ,CAACI,QAAT;AACD;;AACDP,gCAAY,GAAGJ,EAAE,CAACK,SAAlB;AACD,mBANsC,EAMpC,EANoC,CAAvC;AAOD,iBARsB,CAAvB;AASAC,gCAAgB,CAAChB,IAAjB,CAAsB,8DAAtB,EAA8BC,SAA9B,CAAwC,UAAClC,MAAD,EAAY;AAClDuD,+BAAa,CAAC,MAAI,CAACJ,oBAAN,CAAb;AACA,sBAAIK,YAAY,GACdT,YAAY,IAAK/C,MAAiB,GAAG6C,eAAzB,CADd;AAEAF,oBAAE,CAACK,SAAH,GAAeQ,YAAf,CAJkD,CAKlD;AACA;AACA;;AACA,wBAAI,CAACf,OAAL,CAAaG,OAAb,GAAuB,IAAvB;;AACA,wBAAI,CAACa,cAAL,CAAoBH,QAApB;AACD,iBAVD;AAWD,eAzBD;AA0BD,aA7BH;AA8BA,iBAAKnD,SAAL,CAAeuD,eAAf,CACGzB,IADH,CACQ,8EAAe,IAAf,CADR,EAEGC,SAFH,CAEa,UAACyB,KAAD,EAAW;AACpB,oBAAI,CAACC,aAAL,CAAmBC,UAAnB,CAA8BF,KAA9B,EADoB,CAEpB;;AACD,aALH;AAMA,iBAAKxD,SAAL,CAAe2D,iBAAf,CACG7B,IADH,CACQ,8EAAe,IAAf,CADR,EAEGC,SAFH,CAEa,UAACL,KAAD,EAAW;AACpB,oBAAI,CAAC1B,SAAL,CAAe4D,YAAf,CAA4B,MAAI,CAAC5D,SAAL,CAAe6D,QAAf,CAAwBnC,KAAxB,CAA5B;;AACA,oBAAI,CAAC1B,SAAL,CAAe8D,QAAf,CAAwB,MAAI,CAAC9D,SAAL,CAAe6D,QAAf,CAAwBnC,KAAxB,CAAxB;;AACAqC,0BAAY,CAAC,MAAI,CAACC,qBAAN,CAAZ;;AACA,oBAAI,CAACzD,GAAL,CAAS0B,aAAT;;AACA,oBAAI,CAACwB,aAAL,CAAmBQ,eAAnB,CAAmCvC,KAAnC,EAA0CP,IAA1C,CAA+C,UAACa,MAAD,EAAY,CAAE,CAA7D;;AACA,oBAAI,CAACgC,qBAAL,GAA6BE,UAAU,CAAC,YAAM;AAC5C,sBAAI,CAACC,cAAL;;AACA,sBAAI,CAACb,cAAL,CAAoBc,QAApB,GAA+B,KAA/B;AACD,eAHsC,EAGpC,IAHoC,CAAvC;AAID,aAZH;AAaA,iBAAKpE,SAAL,CAAeqE,cAAf,CAA8BtC,SAA9B,CAAwC,UAACuC,GAAD,EAAS;AAC/C,kBAAIA,GAAJ,EAAS;AACP,sBAAI,CAAChB,cAAL,CAAoBH,QAApB;;AACA,sBAAI,CAACG,cAAL,CAAoBc,QAApB,GAA+B,IAA/B;AACD,eAHD,MAGO,CACL;AACD;AACF,aAPD;AAQD;AAhJ4B;AAAA;AAAA,4CAiJX;AAChB,iBAAKpE,SAAL,CAAeuE,qBAAf,CAAqC,IAArC;AACD;AAnJ4B;AAAA;AAAA,qCAqJlB;AACT,mBAAO,KAAKvE,SAAL,CAAe6D,QAAtB;AACD;AAvJ4B;AAAA;AAAA,4CAwJX;AAChB,gBAAIW,KAAK,GAAG;AACV5C,qBAAO,EAAE,KAAKA,OADJ;AAEV6C,iCAAmB,EAAE,CAAC,KAAK1E,sBAAL,CAA4B2E,MAFxC;AAGVC,mCAAqB,EAAE;AAHb,aAAZ;AAKA,iBAAKzE,KAAL,CACG0E,YADH,CACgB,gGADhB,EACsCJ,KADtC,EAEG1C,IAFH,CAEQ,6DAAK,CAAL,CAFR,EAGGC,SAHH;AAID;AAlK4B;AAAA;AAAA,0CAmKb;AACd,mBAAO,KAAKH,OAAL,IAAgB,IAAvB;AACD;AArK4B;AAAA;AAAA,2CAsKZ;AACf,gBAAI,KAAKiD,aAAL,EAAJ,EAA0B;AACxB,qBAAO,gEAAQC,OAAR,CAAgB,KAAKlD,OAArB,CAAP;AACD;;AACD,mBAAO,KAAP;AACD;AA3K4B;AAAA;AAAA,4CA4KX;AAChB,gBAAI,KAAKiD,aAAL,EAAJ,EAA0B;AACxB,qBAAO,gEAAQE,QAAR,CAAiB,KAAKnD,OAAtB,CAAP;AACD;;AACD,mBAAO,KAAP;AACD;AAjL4B;AAAA;AAAA,yCAkLd;AACb,gBAAIoD,QAAJ;;AACA,gBAAI,KAAKH,aAAL,EAAJ,EAA0B;AACxBG,sBAAQ,GAAG,eAAX;AACAA,sBAAQ,IAAI,gEAAQC,cAAR,CAAuB,KAAKrD,OAA5B,CAAZ;AACD,aAHD,MAGO;AACLoD,sBAAQ,GAAG,gBAAX;AACD;;AACD,mBAAOA,QAAP;AACD;AA3L4B;AAAA;AAAA,gCA6LvBtD,KA7LuB,EA6LhBwD,MA7LgB,EA6LR;AACnB,mBAAOA,MAAM,CAACC,GAAd;AACD;AA/L4B;AAAA;AAAA,2CAgMZ;AACf,iBAAK7C,OAAL,CAAa6B,cAAb,CAA4B,GAA5B;AACD;AAlM4B;AAAA;AAAA,mCAmMpBiB,KAnMoB,EAmMb;AACd,iBAAKpF,SAAL,CAAeqF,eAAf;AACD;AArM4B;;AAAA;AAAA,S;;;;gBA7CtB;;gBADA;;gBAMP;;gBAFO;;gBAFA;;gBAqBA;;gBACA;;gBAhBP;;gBAUA;;gBARA;;;;;;gBAqCC,wD;AAAS,iBAAC,SAAD,EAAY;AAAE,sBAAQ;AAAV,WAAZ;;;gBACT,wD;AAAS,iBAAC,+DAAD,EAAmB;AAAE,sBAAQ;AAAV,WAAnB;;;gBAET,wD;AAAS,iBAAC,gEAAD,EAAoB;AAAE,sBAAQ;AAAV,WAApB;;;AAJCvF,wBAAkB,6DAP9B,6EAO8B,EAN9B,iEAAU;AACTwF,gBAAQ,EAAE,qBADD;AAETC,gBAAQ,EAAR,6EAFS;AAGTC,uBAAe,EAAE,uEAAwBC,MAHhC;;AAAA,OAAV,CAM8B,E,+EAgBI,yF,EACb,8D,EACK,4D,EACR,2E,EACH,gE,EACG,8D,EACD,4D,EACI,uD,EACL,gE,EACY,8D,EAzBE,GAAlB3F,kBAAkB,CAAlB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC3Cb,UAAM4F,MAAM,GAAW,CACrB;AACEC,YAAI,EAAE,EADR;AAEEC,iBAAS,EAAE;AAFb,OADqB,CAAvB;;UAWaC,+BAA+B;AAAA;AAAA,O;;AAA/BA,qCAA+B,6DAJ3C,+DAAS;AACRC,eAAO,EAAE,CAAC,6DAAaC,QAAb,CAAsBL,MAAtB,CAAD,CADD;AAERM,eAAO,EAAE,CAAC,4DAAD;AAFD,OAAT,CAI2C,GAA/BH,+BAA+B,CAA/B;;;;;;;;;;;;;;;;AChBb;AAAe;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCyBFI,wBAAwB;AAAA;AAAA,O;;AAAxBA,8BAAwB,6DAZpC,+DAAS;AACRH,eAAO,EAAE,CACP,4DADO,EAEP,0DAFO,EAGP,0DAHO,EAIP,+FAJO,EAKP,+GALO,EAMP,gFANO,EAOP,2EAPO,CADD;AAURI,oBAAY,EAAE,CAAC,wEAAD;AAVN,OAAT,CAYoC,GAAxBD,wBAAwB,CAAxB","file":"messaging-message-session-message-session-module-es5.js","sourcesContent":["export default \"@font-face {\\n  font-family: myIranSans;\\n  src: url('IRANSans.ttf');\\n  font-weight: 400;\\n}\\n@font-face {\\n  font-family: myIranSans;\\n  src: url('IRANSans_Bold.ttf');\\n  font-weight: 700;\\n}\\n@font-face {\\n  font-family: myIranSans;\\n  src: url('IRANSans_Light.ttf');\\n  font-weight: 300;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_UltraLight.ttf');\\n  font-weight: 200;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Medium.ttf');\\n  font-weight: 500;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum).ttf');\\n  font-weight: 400;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Bold.ttf');\\n  font-weight: 700;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Light.ttf');\\n  font-weight: 300;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_UltraLight.ttf');\\n  font-weight: 200;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Medium.ttf');\\n  font-weight: 500;\\n}\\nion-title .avatar {\\n  width: 2.5rem;\\n  height: 2.5rem;\\n  border-radius: 50px;\\n  background-position: center center;\\n  background-size: cover;\\n  margin-left: 10px;\\n  margin-top: 2px;\\n}\\nion-title .online-status {\\n  padding-top: 4px;\\n  padding-left: 10px;\\n  line-height: 2px;\\n}\\nion-title .online-status ion-icon.online {\\n  color: lime;\\n}\\nion-title .online-status ion-icon.offline {\\n  color: gray;\\n}\\n.chat-content .input {\\n  align-self: end;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy90aGVtZS9mb250cy5zY3NzIiwic3JjL2FwcC9tZXNzYWdpbmcvbWVzc2FnZS1zZXNzaW9uL21lc3NhZ2Utc2Vzc2lvbi5wYWdlLnNjc3MiLCJzcmMvdGhlbWUvY29tbW9uLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSx1QkFBQTtFQUNBLHdCQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBRENFO0VBQ0UsdUJBQUE7RUFDQSw2QkFBQTtFQUNBLGdCQUFBO0FDQ0o7QURDRTtFQUNFLHVCQUFBO0VBQ0EsOEJBQUE7RUFDQSxnQkFBQTtBQ0NKO0FEQ0U7RUFDRSw0QkFBQTtFQUNBLDBDQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBRENFO0VBQ0UsNEJBQUE7RUFDQSxzQ0FBQTtFQUNBLGdCQUFBO0FDQ0o7QURDRTtFQUNFLDRCQUFBO0VBQ0EsK0JBQUE7RUFDQSxnQkFBQTtBQ0NKO0FEQ0U7RUFDRSw0QkFBQTtFQUNBLG9DQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBRENFO0VBQ0UsNEJBQUE7RUFDQSxxQ0FBQTtFQUNBLGdCQUFBO0FDQ0o7QURDRTtFQUNFLDRCQUFBO0VBQ0EsMENBQUE7RUFDQSxnQkFBQTtBQ0NKO0FEQ0U7RUFDRSw0QkFBQTtFQUNBLHNDQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBQTlDRTtFQUNFLGFBQUE7RUFDQSxjQUFBO0VBQ0EsbUJBQUE7RUFDQSxrQ0FBQTtFQUNBLHNCQUFBO0VBQ0EsaUJBQUE7RUFDQSxlQUFBO0FBZ0RKO0FBOUNFO0VBQ0UsZ0JBQUE7RUFDQSxrQkFBQTtFQUNBLGdCQUFBO0FBZ0RKO0FBOUNNO0VBQ0UsV0FBQTtBQWdEUjtBQTlDTTtFQUNFLFdDRk87QURrRGY7QUF0Q0U7RUFDRSxlQUFBO0FBd0NKIiwiZmlsZSI6InNyYy9hcHAvbWVzc2FnaW5nL21lc3NhZ2Utc2Vzc2lvbi9tZXNzYWdlLXNlc3Npb24ucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiQGZvbnQtZmFjZSB7XG4gICAgZm9udC1mYW1pbHk6IG15SXJhblNhbnM7XG4gICAgc3JjOiB1cmwoJy4uL2Fzc2V0cy9mb250cy9JUkFOU2Fucy50dGYnKTtcbiAgICBmb250LXdlaWdodDogNDAwO1xuICB9XG4gIEBmb250LWZhY2Uge1xuICAgIGZvbnQtZmFtaWx5OiBteUlyYW5TYW5zO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnNfQm9sZC50dGYnKTtcbiAgICBmb250LXdlaWdodDogNzAwO1xuICB9XG4gIEBmb250LWZhY2Uge1xuICAgIGZvbnQtZmFtaWx5OiBteUlyYW5TYW5zO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnNfTGlnaHQudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDMwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX1VsdHJhTGlnaHQudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDIwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX01lZGl1bS50dGYnKTtcbiAgICBmb250LXdlaWdodDogNTAwO1xuICB9XG4gIEBmb250LWZhY2Uge1xuICAgIGZvbnQtZmFtaWx5OiBteUlyYW5TYW5zRmFOdW07XG4gICAgc3JjOiB1cmwoJy4uL2Fzc2V0cy9mb250cy9JUkFOU2FucyhGYU51bSkudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX0JvbGQudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDcwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX0xpZ2h0LnR0ZicpO1xuICAgIGZvbnQtd2VpZ2h0OiAzMDA7XG4gIH1cbiAgQGZvbnQtZmFjZSB7XG4gICAgZm9udC1mYW1pbHk6IG15SXJhblNhbnNGYU51bTtcbiAgICBzcmM6IHVybCgnLi4vYXNzZXRzL2ZvbnRzL0lSQU5TYW5zKEZhTnVtKV9VbHRyYUxpZ2h0LnR0ZicpO1xuICAgIGZvbnQtd2VpZ2h0OiAyMDA7XG4gIH1cbiAgQGZvbnQtZmFjZSB7XG4gICAgZm9udC1mYW1pbHk6IG15SXJhblNhbnNGYU51bTtcbiAgICBzcmM6IHVybCgnLi4vYXNzZXRzL2ZvbnRzL0lSQU5TYW5zKEZhTnVtKV9NZWRpdW0udHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgfSIsIkBpbXBvcnQgXCJzcmMvdGhlbWUvY29tbW9uLnNjc3NcIjtcblxuaW9uLXRpdGxlIHtcbiAgLmF2YXRhciB7XG4gICAgd2lkdGg6IDIuNXJlbTtcbiAgICBoZWlnaHQ6IDIuNXJlbTtcbiAgICBib3JkZXItcmFkaXVzOiA1MHB4O1xuICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlciBjZW50ZXI7XG4gICAgYmFja2dyb3VuZC1zaXplOiBjb3ZlcjtcbiAgICBtYXJnaW4tbGVmdDogMTBweDtcbiAgICBtYXJnaW4tdG9wOiAycHg7XG4gIH1cbiAgLm9ubGluZS1zdGF0dXMge1xuICAgIHBhZGRpbmctdG9wOiA0cHg7XG4gICAgcGFkZGluZy1sZWZ0OiAxMHB4O1xuICAgIGxpbmUtaGVpZ2h0OiAycHg7XG4gICAgaW9uLWljb24ge1xuICAgICAgJi5vbmxpbmUge1xuICAgICAgICBjb2xvcjogJG9ubGluZS1jb2xvcjtcbiAgICAgIH1cbiAgICAgICYub2ZmbGluZSB7XG4gICAgICAgIGNvbG9yOiAkb2ZmbGluZS1jb2xvcjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLm5hbWUtdGV4dCB7XG4gIH1cbiAgLnNlc3Npb24tc3RhdHVzIHtcbiAgfVxufVxuLmNoYXQtY29udGVudCB7XG4gIC5pbnB1dCB7XG4gICAgYWxpZ24tc2VsZjogZW5kO1xuICB9XG59XG5cbiIsIlxuQGltcG9ydCAnZm9udHMuc2Nzcyc7XG4kZm9udCA6IFwibXlJcmFuU2Fuc1wiO1xuJGZvbnROdW0gOiBcIm15SXJhblNhbnNGYU51bVwiO1xuJHByaW1hcnktY29sb3ItZGFyazogIzQ3OTY5YjtcbiRwcmltYXJ5LWNvbG9yLWxpZ2h0OiNhNWRhZGU7XG4kcHJpbWFyeS1jb2xvci14ZGFyazojMmM4MTg2O1xuJHByaW1hcnktY29sb3IteGxpZ2h0OiNkN2YzZjY7XG4kcHJpbWFyeS1jb2xvcjogIzcxYmNjMTtcbiRzZWNvbmRhcnktY29sb3ItZGFyazogI2NlMzIxYztcbiRzZWNvbmRhcnktY29sb3ItbGlnaHQ6I2ZlN2Y3MDtcbiRzZWNvbmRhcnktY29sb3IteGRhcms6I2EyMWQwYTtcbiRzZWNvbmRhcnktY29sb3IteGxpZ2h0OiNmZmExOTg7XG4kc2Vjb25kYXJ5LWNvbG9yOiAjZTY1ODQ0O1xuJHRlcnRpYXJ5LWNvbG9yOiM3MWNlOTk7XG4kcXVhdGVybmFyeS1jb2xvcjojZWViZDYwO1xuJGRhcmstdGV4dC1jb2xvcjojNGU0ZTRlO1xuJGxpZ2h0LXRleHQtY29sb3I6I2E1YTVhNTtcbiRvbmxpbmUtY29sb3I6bGltZTtcbiRvZmZsaW5lLWNvbG9yOmdyYXk7XG5AbWl4aW4gcm90YXRlKCRkZWdyZWVzKSB7XG4gICAgLXdlYmtpdC10cmFuc2Zvcm06IHJvdGF0ZSgkZGVncmVlcyk7XG4gICAgLW1vei10cmFuc2Zvcm06IHJvdGF0ZSgkZGVncmVlcyk7XG4gICAgLW1zLXRyYW5zZm9ybTogcm90YXRlKCRkZWdyZWVzKTtcbiAgICAtby10cmFuc2Zvcm06IHJvdGF0ZSgkZGVncmVlcyk7XG4gICAgdHJhbnNmb3JtOiByb3RhdGUoJGRlZ3JlZXMpO1xufVxuQG1peGluIGJveC1zaGFkb3coJGxlZnQsICR0b3AsICRyYWRpdXMsICRjb2xvcikge1xuXHRib3gtc2hhZG93OiAkbGVmdCAkdG9wICRyYWRpdXMgJGNvbG9yO1xuXHQtd2Via2l0LWJveC1zaGFkb3c6ICRsZWZ0ICR0b3AgJHJhZGl1cyAkY29sb3I7XG5cdC1tb3otYm94LXNoYWRvdzogJGxlZnQgJHRvcCAkcmFkaXVzICRjb2xvcjtcbn1cbkBtaXhpbiBib3gtc2hhZG93LWZ1bGwoJGxlZnQsICR0b3AsICRibHVyLCAkc3ByZWFkLCAkY29sb3IpIHtcblx0Ym94LXNoYWRvdzogJGxlZnQgJHRvcCAkYmx1ciAkc3ByZWFkICRjb2xvcjtcblx0LXdlYmtpdC1ib3gtc2hhZG93OiAkbGVmdCAkdG9wICRibHVyICRzcHJlYWQgJGNvbG9yO1xuXHQtbW96LWJveC1zaGFkb3c6ICRsZWZ0ICR0b3AgJGJsdXIgJHNwcmVhZCAkY29sb3I7XG59XG5AbWl4aW4gYm94LXNoYWRvdy1mdWxsLWluc2V0KCRsZWZ0LCAkdG9wLCAkYmx1ciwgJHNwcmVhZCwgJGNvbG9yKSB7XG5cdGJveC1zaGFkb3c6IGluc2V0ICRsZWZ0ICR0b3AgJGJsdXIgJHNwcmVhZCAkY29sb3I7XG5cdC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgJGxlZnQgJHRvcCAkYmx1ciAkc3ByZWFkICRjb2xvcjtcblx0LW1vei1ib3gtc2hhZG93OiBpbnNldCAkbGVmdCAkdG9wICRibHVyICRzcHJlYWQgJGNvbG9yO1xufVxuQG1peGluIGJvcmRlci1yYWRpdXMoJHJhZGl1cykge1xuXHRib3JkZXItcmFkaXVzOiAkcmFkaXVzO1xuXHQtd2Via2l0LWJvcmRlci1yYWRpdXM6ICRyYWRpdXM7XG4gICAgLW1vei1ib3JkZXItcmFkaXVzOiAkcmFkaXVzO1xuICAgIC0tYm9yZGVyLXJhZGl1czokcmFkaXVzO1xufVxuQG1peGluIHRyYW5zZm9ybSgkdHJhbnNmb3Jtcykge1xuXHQtd2Via2l0LXRyYW5zZm9ybTogJHRyYW5zZm9ybXM7XG5cdC1tb3otdHJhbnNmb3JtOiAkdHJhbnNmb3Jtcztcblx0LW1zLXRyYW5zZm9ybTogJHRyYW5zZm9ybXM7XG5cdHRyYW5zZm9ybTogJHRyYW5zZm9ybXM7XG59Il19 */\";","import { SessionInfoComponent } from \"./../../common/session-info/session-info.component\";\nimport { SmartAudioService } from \"src/app/services/smart-audio.service\";\nimport { IMService } from \"../../services/im.service\";\nimport { SessionsManagerService } from \"./../../services/sessions-manager-service\";\nimport { EnvService } from \"./../../services/env.service\";\nimport { User } from \"./../../models/user\";\nimport { AlertService } from \"src/app/services/alert.service\";\nimport {\n  NavController,\n  IonInfiniteScroll,\n  Platform,\n  IonVirtualScroll,\n  ModalController,\n} from \"@ionic/angular\";\nimport {\n  Component,\n  OnInit,\n  ViewChild,\n  ElementRef,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n} from \"@angular/core\";\nimport { Session } from \"src/app/models/session\";\nimport { FormControl, FormGroup } from \"@angular/forms\";\nimport Tinode from \"tinode-sdk\";\nimport { Media, MediaObject } from \"@ionic-native/media/ngx\";\nimport { File, FileEntry } from \"@ionic-native/file/ngx\";\nimport { TypeofExpr } from \"@angular/compiler\";\nimport { debounceTime, last, map, concatMap, take } from \"rxjs/operators\";\nimport { Subscription, Observable, BehaviorSubject, from } from \"rxjs\";\nimport { UntilDestroy, untilDestroyed } from \"@ngneat/until-destroy\";\n\nconst Drafty = Tinode.Drafty;\ninterface SizedEvent {\n  width: number;\n  height: number;\n}\n\nfunction isSizedEvent(e: any): e is SizedEvent {\n  return e && e.width !== undefined && e.height !== undefined;\n}\n@UntilDestroy()\n@Component({\n  selector: \"app-message-session\",\n  templateUrl: \"./message-session.page.html\",\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  styleUrls: [\"./message-session.page.scss\"],\n})\nexport class MessageSessionPage implements OnInit {\n  @ViewChild(\"content\", { static: false }) private content;\n  @ViewChild(IonVirtualScroll, { static: false })\n  vitrualScroll: IonVirtualScroll;\n  @ViewChild(IonInfiniteScroll, { static: false })\n  infiniteScroll: IonInfiniteScroll;\n  session: Session;\n  title: string;\n  form: FormGroup;\n  getName = User.getName;\n\n  scrollToBottomTimeOut;\n  isTyping = false;\n  isOnline = false;\n  heightIntervalHandle;\n  constructor(\n    public sessionsManagerService: SessionsManagerService,\n    public imService: IMService,\n    private navController: NavController,\n    private alert: AlertService,\n    public env: EnvService,\n    private media: Media,\n    private file: File,\n    private platform: Platform,\n    private ref: ChangeDetectorRef,\n    private modalController: ModalController\n  ) {\n    this.form = new FormGroup({\n      sendInput: new FormControl(\"\"),\n    });\n    this.ref.detach();\n    //this.smartAudio.preload(\"beep1\", \"assets/audio/beep1.mp3\");\n  }\n  ionViewWillLeave() {\n    this.sessionsManagerService.leaveChatPage();\n    //this.messageFileFetchSuccessSubscription.unsubscribe();\n    //this.messageFileProgressSubscription.unsubscribe();\n  }\n  ionViewWillEnter() {}\n  ngOnInit() {\n    if (!this.sessionsManagerService.hasActiveIMTopic) {\n      this.alert.presentError(\"چت هماهنگی معتبر نیست.\");\n      this.sessionsManagerService.returnUrlIfNoActiveIMTopic().then((url) => {\n        this.navController.navigateRoot([url]);\n      });\n    } else {\n      this.title = this.sessionsManagerService.IMPeerUser.first_name;\n    }\n  }\n\n  itemHeight(item, index) {\n    if (item.isImage) {\n      return 213;\n    }\n\n    return 45;\n    return 40;\n  }\n  ionViewCanEnter() {\n    //this.infiniteScroll.disabled = true;\n  }\n  ngAfterViewInit(): void {\n    this.session = this.sessionsManagerService.session;\n    this.env.somethingPendingUpdated\n      .pipe(untilDestroyed(this))\n      .subscribe((result) => {\n        this.ref.detectChanges();\n      });\n    if (this.sessionsManagerService.hasActiveIMTopic) {\n      this.isOnline = this.sessionsManagerService.isUserOnline(\n        this.sessionsManagerService.IMPeerUser\n      );\n      this.sessionsManagerService\n        .addOnlineObserver(this.sessionsManagerService.IMPeerUser)\n        .pipe(untilDestroyed(this))\n        .subscribe((result) => {\n          this.isOnline = result;\n          this.ref.detectChanges();\n        });\n    }\n\n    this.imService.isTypingSubject\n      .pipe(untilDestroyed(this))\n      .subscribe((result) => {\n        this.isTyping = result;\n        this.ref.detectChanges();\n      });\n    this.imService.messageAddedToStart\n      .pipe(debounceTime(400), untilDestroyed(this))\n      .subscribe((index) => {\n        this.content.getScrollElement().then((el) => {\n          this.ref.detectChanges();\n          this.content.scrollY = false;\n          var oldScrollHeight = el.scrollHeight;\n          var oldScrollTop = el.scrollTop;\n          let heightObservable = new Observable((observer) => {\n            this.heightIntervalHandle = setInterval(() => {\n              if (el.scrollHeight != oldScrollHeight) {\n                observer.next(el.scrollHeight);\n                observer.complete();\n              }\n              oldScrollTop = el.scrollTop;\n            }, 50);\n          });\n          heightObservable.pipe(last()).subscribe((height) => {\n            clearInterval(this.heightIntervalHandle);\n            let newScrollTop =\n              oldScrollTop + ((height as number) - oldScrollHeight);\n            el.scrollTop = newScrollTop;\n            // this.content.scrollToPoint(null, newScrollTop, 0).then(()=>{\n            //   this.content.scrollY = true;\n            // });\n            this.content.scrollY = true;\n            this.infiniteScroll.complete();\n          });\n        });\n      });\n    this.imService.messageGotDirty\n      .pipe(untilDestroyed(this))\n      .subscribe((dirty) => {\n        this.vitrualScroll.checkRange(dirty);\n        //this.ref.detectChanges();\n      });\n    this.imService.messageAddedToEnd\n      .pipe(untilDestroyed(this))\n      .subscribe((index) => {\n        this.imService.noteReceived(this.imService.messages[index]);\n        this.imService.noteRead(this.imService.messages[index]);\n        clearTimeout(this.scrollToBottomTimeOut);\n        this.ref.detectChanges();\n        this.vitrualScroll.positionForItem(index).then((result) => {});\n        this.scrollToBottomTimeOut = setTimeout(() => {\n          this.scrollToBottom();\n          this.infiniteScroll.disabled = false;\n        }, 1000);\n      });\n    this.imService.noMoreMessages.subscribe((yes) => {\n      if (yes) {\n        this.infiniteScroll.complete();\n        this.infiniteScroll.disabled = true;\n      } else {\n        //this.infiniteScroll.disabled = false;\n      }\n    });\n  }\n  ionViewDidEnter() {\n    this.imService.notifyEnteredChatPage(true);\n  }\n\n  messages() {\n    return this.imService.messages;\n  }\n  openSessionInfo() {\n    let props = {\n      session: this.session,\n      providerPerspective: !this.sessionsManagerService.isUser,\n      openedFromSessionChat: true,\n    };\n    this.alert\n      .presentModal(SessionInfoComponent, props)\n      .pipe(take(1))\n      .subscribe();\n  }\n  isSessionChat() {\n    return this.session != null;\n  }\n  isSessionEnded() {\n    if (this.isSessionChat()) {\n      return Session.isEnded(this.session);\n    }\n    return false;\n  }\n  isSessionActive() {\n    if (this.isSessionChat()) {\n      return Session.isActive(this.session);\n    }\n    return false;\n  }\n  chatSubtitle() {\n    let subtitle: string;\n    if (this.isSessionChat()) {\n      subtitle = \"جلسه مشاوره: \";\n      subtitle += Session.getStateString(this.session);\n    } else {\n      subtitle = \"گفتگوی هماهنگی\";\n    }\n    return subtitle;\n  }\n\n  track(index, record) {\n    return record.seq;\n  }\n  scrollToBottom() {\n    this.content.scrollToBottom(300);\n  }\n  nextPage(event) {\n    this.imService.getMessagesPage();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { MessageSessionPage } from './message-session.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MessageSessionPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class MessageSessionPageRoutingModule {}\n","export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button menu=\\\"end\\\">\\n        <ion-icon name=\\\"menu-outline\\\"></ion-icon>\\n      </ion-menu-button>\\n    </ion-buttons>\\n    <ion-title *ngIf=\\\"(sessionsManagerService.IMPeerUser)\\\">\\n      <div class=\\\"row no-gutters\\\">\\n        <div class=\\\"col-auto\\\">\\n          \\n          <app-user-avatar class=\\\"primary-background\\\" [user]=\\\"sessionsManagerService.IMPeerUser\\\"></app-user-avatar>\\n        </div>\\n        <div class=\\\"col d-flex flex-column justify-content-center\\\">\\n          <div class=\\\"row no-gutters\\\">\\n            <div class=\\\"col col-auto \\\">\\n              <ion-icon\\n                [ngClass]=\\\"isOnline?'online':''\\\"\\n                [name]=\\\"this.env.ONLINE_ICON\\\"\\n                class=\\\"online-status\\\"\\n              ></ion-icon>\\n            </div>\\n            <span class=\\\" name-text\\\">\\n              {{getName(this.sessionsManagerService.IMPeerUser)}}\\n            </span>\\n          </div>\\n\\n          <small class=\\\" session-status\\\">\\n            {{chatSubtitle()}}\\n          </small>\\n        </div>\\n      </div>\\n    </ion-title>\\n    <ion-buttons class=\\\"\\\" slot=\\\"end\\\">\\n      \\n     \\n      <ion-button *ngIf=\\\"isSessionChat()\\\" (click)=\\\"openSessionInfo()\\\" >\\n        <ion-icon name=\\\"settings-outline\\\"></ion-icon>\\n      </ion-button>\\n      <ion-back-button  ></ion-back-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content #content>\\n  <div class=\\\"chat-content\\\" #chatContent>\\n    <ion-infinite-scroll\\n      threshold=\\\"0px\\\"\\n      (ionInfinite)=\\\"nextPage($event)\\\"\\n      position=\\\"top\\\"\\n    >\\n      <ion-infinite-scroll-content> </ion-infinite-scroll-content>\\n    </ion-infinite-scroll>\\n    <div class=\\\"no-provider h-100 d-flex flex-column justify-content-center align-items-center\\\" *ngIf=\\\"!messages() || messages().length <1\\\">\\n      <ion-img src=\\\"/assets/image/no-providers.jpg\\\"></ion-img>\\n      <span class=\\\"light-text normal-text\\\">\\n        هنوز پیامی رد و بدل نشده است.\\n      </span>\\n    </div>\\n    <ion-virtual-scroll [items]=\\\"messages()\\\" [trackBy]=\\\"track\\\" [itemHeight]=\\\"itemHeight\\\">\\n      <div class=\\\"row\\\"  *virtualItem=\\\"let message\\\" >\\n        \\n          <app-message-content class=\\\"col-12\\\" *ngIf=\\\"message\\\" [message]=\\\"message\\\"></app-message-content>\\n   \\n      </div>\\n    </ion-virtual-scroll>\\n    \\n    <div class=\\\"row\\\" *ngIf=\\\"this.isTyping\\\">\\n      <app-typing-message class=\\\"col-12\\\"></app-typing-message>\\n    </div>\\n  </div>\\n</ion-content>\\n<app-send-message *ngIf=\\\"!isSessionEnded()\\\">\\n\\n</app-send-message>\";","import { MessagingModule } from './../messaging/messaging.module';\nimport { NgxIonicImageViewerModule } from 'ngx-ionic-image-viewer';\nimport { CommonDeclarationsModule } from './../../common/common-declarations/common-declarations.module';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MessageSessionPageRoutingModule } from './message-session-routing.module';\n\nimport { MessageSessionPage } from './message-session.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    MessageSessionPageRoutingModule,\n    CommonDeclarationsModule,\n    NgxIonicImageViewerModule,\n    MessagingModule\n  ],\n  declarations: [MessageSessionPage]\n})\nexport class MessageSessionPageModule {}\n"]}