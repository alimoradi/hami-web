{"version":3,"sources":["./src/app/messaging/messenger/messenger.page.html","./src/app/messaging/messenger/messenger.page.ts","./src/app/messaging/messenger/messenger.page.scss","./src/app/messaging/messenger/messenger-routing.module.ts","./src/app/messaging/messenger/messenger.module.ts"],"names":[],"mappings":"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","file":"messaging-messenger-messenger-module-es2015.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button menu=\\\"end\\\">\\n        <ion-icon name=\\\"menu-outline\\\"></ion-icon>\\n      </ion-menu-button>\\n    </ion-buttons>\\n    <ion-title *ngIf=\\\"(peerUser)\\\">\\n      <div class=\\\"row no-gutters\\\">\\n        <div class=\\\"col-auto\\\">\\n          <app-user-avatar\\n            class=\\\"primary-background\\\"\\n            [user]=\\\"peerUser\\\"\\n          ></app-user-avatar>\\n        </div>\\n        <div class=\\\"col d-flex flex-column justify-content-center\\\">\\n          <div class=\\\"row no-gutters\\\">\\n            <div class=\\\"col col-auto\\\">\\n              <ion-icon\\n                [ngClass]=\\\"this.sessionsManager.isUserOnline(peerUser)?'online':''\\\"\\n                [name]=\\\"this.env.ONLINE_ICON\\\"\\n                class=\\\"online-status\\\"\\n              ></ion-icon>\\n            </div>\\n            <span class=\\\"name-text\\\"> {{name}} </span>\\n          </div>\\n\\n          <small class=\\\"session-status\\\"> {{subtitle}} </small>\\n        </div>\\n      </div>\\n    </ion-title>\\n    <ion-buttons class=\\\"\\\" slot=\\\"end\\\">\\n      <ion-button\\n        *ngIf=\\\"chatType && chatType==chatTypeEnum.SESSION\\\"\\n        (click)=\\\"openSessionInfo()\\\"\\n      >\\n        <ion-icon name=\\\"settings-outline\\\"></ion-icon>\\n      </ion-button>\\n      <ion-back-button [defaultHref]=\\\"backUrl()\\\"></ion-back-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content #content>\\n  <div class=\\\"chat-content\\\" #chatContent>\\n    <ion-infinite-scroll\\n      threshold=\\\"0px\\\"\\n      (ionInfinite)=\\\"nextPage($event)\\\"\\n      position=\\\"top\\\"\\n    >\\n      <ion-infinite-scroll-content> </ion-infinite-scroll-content>\\n    </ion-infinite-scroll>\\n    <ion-virtual-scroll\\n      [items]=\\\"messages()\\\"\\n      [trackBy]=\\\"track\\\"\\n      [itemHeight]=\\\"itemHeight\\\"\\n    >\\n      <div class=\\\"row\\\" *virtualItem=\\\"let message\\\">\\n        <app-message-content\\n          class=\\\"col-12\\\"\\n          *ngIf=\\\"message\\\"\\n          [message]=\\\"message\\\"\\n        ></app-message-content>\\n      </div>\\n    </ion-virtual-scroll>\\n    <div class=\\\"row\\\" *ngIf=\\\"this.isTyping\\\">\\n      <app-typing-message class=\\\"col-12\\\"></app-typing-message>\\n    </div>\\n  </div>\\n</ion-content>\\n<app-send-message *ngIf=\\\"!isEndedSessionChat()\\\">\\n\\n</app-send-message>\";","import { RoleId } from \"./../../models/user\";\nimport { Observable } from \"rxjs\";\nimport { IMService } from \"src/app/services/im.service\";\nimport { EnvService } from \"src/app/services/env.service\";\nimport { SessionInfoComponent } from \"./../../common/session-info/session-info.component\";\nimport { AlertService } from \"src/app/services/alert.service\";\nimport { UserService } from \"src/app/services/user.service\";\nimport { ProviderService } from \"src/app/services/provider.service\";\nimport { User } from \"src/app/models/user\";\nimport { Provider } from \"src/app/models/provider\";\nimport { Session } from \"src/app/models/session\";\nimport { ActivatedRoute } from \"@angular/router\";\nimport {\n  SessionsManagerService,\n  ChatType,\n} from \"src/app/services/sessions-manager-service\";\nimport {\n  Component,\n  OnInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  ViewChild,\n} from \"@angular/core\";\nimport { UntilDestroy, untilDestroyed } from \"@ngneat/until-destroy\";\nimport { SharedResourceAsyncRequestBundle } from \"src/app/architecture/shared-resource-async-request-bundle\";\nimport { take, debounceTime, last } from \"rxjs/operators\";\nimport { IonVirtualScroll, IonInfiniteScroll } from \"@ionic/angular\";\n\n@UntilDestroy()\n@Component({\n  selector: \"app-messenger\",\n  templateUrl: \"./messenger.page.html\",\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  styleUrls: [\"./messenger.page.scss\"],\n})\nexport class MessengerPage implements OnInit {\n  @ViewChild(\"content\", { static: false }) private content;\n  @ViewChild(IonVirtualScroll, { static: false })\n  vitrualScroll: IonVirtualScroll;\n  @ViewChild(IonInfiniteScroll, { static: false })\n  infiniteScroll: IonInfiniteScroll;\n\n  audience: Session | Provider | User;\n  name: string;\n  subtitle: string;\n  chatType: ChatType = null;\n  providerPerspective: boolean = null;\n  chatTypeEnum = ChatType;\n  peerUser: User = null;\n  isTyping: boolean = false;\n\n  heightIntervalHandle;\n  scrollToBottomTimeOut;\n  constructor(\n    public sessionsManager: SessionsManagerService,\n    private route: ActivatedRoute,\n    private providerService: ProviderService,\n    private userService: UserService,\n    private ref: ChangeDetectorRef,\n    private alert: AlertService,\n    public env: EnvService,\n    public imService: IMService\n  ) {}\n\n  ngOnInit() {\n    this.getAudience();\n    this.handleNewMessage();\n    this.handleTyping();\n  }\n  messages() {\n    return this.imService.messages;\n  }\n  track(index, record) {\n    return record.seq;\n  }\n  scrollToBottom() {\n    this.content.scrollToBottom(300);\n  }\n  nextPage(event) {\n    this.imService.getMessagesPage();\n  }\n  itemHeight(item, index) {\n    if (item.isImage) {\n      return 213;\n    }\n\n    return 45;\n    return 40;\n  }\n  getAudience() {\n    this.chatType = parseInt(this.route.snapshot.params.type);\n    this.providerPerspective =\n      parseInt(this.route.snapshot.params.providerPerspective) == 1;\n    let id = parseInt(this.route.snapshot.params.id);\n    let sharedResource: SharedResourceAsyncRequestBundle<any, any> = null;\n\n    switch (this.chatType) {\n      case ChatType.P2P_WITH_PROVIDER:\n        sharedResource = this.providerService.providerByUserIdShared;\n        break;\n      case ChatType.P2P_WITH_USER:\n        sharedResource = this.userService.userShared;\n        break;\n      case ChatType.SESSION:\n        sharedResource = this.sessionsManager.sessionShared;\n      default:\n    }\n\n    sharedResource.getUpdateNotifier(this).subscribe((result) => {\n      this.audience = sharedResource.resource();\n      \n      switch (this.chatType) {\n        case ChatType.P2P_WITH_PROVIDER:\n          this.peerUser = (this.audience as Provider).user;\n          this.name = User.getName(this.peerUser);\n          this.subtitle = \"گفتگوی هماهنگی\";\n          break;\n        case ChatType.P2P_WITH_USER:\n          this.subtitle = \"گفتگوی هماهنگی\";\n          this.peerUser = this.audience as User;\n          this.name = User.getName(this.peerUser);\n          break;\n        case ChatType.SESSION:\n          this.subtitle = \"جلسه مشاوره: \";\n\n          if (this.providerPerspective) {\n            this.peerUser = (this.audience as Session).user;\n          } else {\n            this.peerUser = (this.audience as Session).provider.user;\n          }\n          this.name = User.getName(this.peerUser);\n          break;\n        default:\n      }\n      this.ref.detectChanges();\n      this.sessionsManager.startPeer2PeerChat(this.peerUser);\n    });\n\n    sharedResource.request(id);\n  }\n  openSessionInfo() {\n    let sessionId = (this.audience as Session).id;\n    let props = {\n      session: this.audience as Session,\n      providerPerspective: !this.providerPerspective,\n      openedFromSessionChat: true,\n    };\n    this.alert\n      .presentModal(SessionInfoComponent, props)\n      .pipe(take(1))\n      .subscribe();\n  }\n  handleTyping() {\n    this.imService.isTypingSubject\n      .pipe(untilDestroyed(this))\n      .subscribe((result) => {\n        this.isTyping = result;\n        this.ref.detectChanges();\n      });\n  }\n  handleNewMessage() {\n    this.imService.messageAddedToStart\n      .pipe(debounceTime(400), untilDestroyed(this))\n      .subscribe((index) => {\n        this.content.getScrollElement().then((el) => {\n          this.ref.detectChanges();\n          this.content.scrollY = false;\n          var oldScrollHeight = el.scrollHeight;\n          var oldScrollTop = el.scrollTop;\n          let heightObservable = new Observable((observer) => {\n            this.heightIntervalHandle = setInterval(() => {\n              if (el.scrollHeight != oldScrollHeight) {\n                observer.next(el.scrollHeight);\n                observer.complete();\n              }\n              oldScrollTop = el.scrollTop;\n            }, 50);\n          });\n          heightObservable.pipe(last()).subscribe((height) => {\n            clearInterval(this.heightIntervalHandle);\n            let newScrollTop =\n              oldScrollTop + ((height as number) - oldScrollHeight);\n            el.scrollTop = newScrollTop;\n            // this.content.scrollToPoint(null, newScrollTop, 0).then(()=>{\n            //   this.content.scrollY = true;\n            // });\n            this.content.scrollY = true;\n            this.infiniteScroll.complete();\n          });\n        });\n      });\n    this.imService.messageGotDirty\n      .pipe(untilDestroyed(this))\n      .subscribe((dirty) => {\n        this.vitrualScroll.checkRange(dirty);\n        //this.ref.detectChanges();\n      });\n    this.imService.messageAddedToEnd\n      .pipe(untilDestroyed(this))\n      .subscribe((index) => {\n        this.imService.noteReceived(this.imService.messages[index]);\n        this.imService.noteRead(this.imService.messages[index]);\n        clearTimeout(this.scrollToBottomTimeOut);\n        this.ref.detectChanges();\n        this.vitrualScroll.positionForItem(index).then((result) => {});\n        this.scrollToBottomTimeOut = setTimeout(() => {\n          this.scrollToBottom();\n          this.infiniteScroll.disabled = false;\n        }, 1000);\n      });\n    this.imService.noMoreMessages.subscribe((yes) => {\n      if (yes) {\n        this.infiniteScroll.complete();\n        this.infiniteScroll.disabled = true;\n      } else {\n        //this.infiniteScroll.disabled = false;\n      }\n    });\n  }\n  backUrl() {\n    let reservationUrlString = this.providerPerspective\n      ? \"pvd-reservations\"\n      : \"usr-reservations\";\n    let peerChatUrlString = 'peer-chats'; \n    switch (this.chatType) {\n      case ChatType.P2P_WITH_PROVIDER:\n        return [peerChatUrlString, RoleId.USER_ROLE_ID];\n        break;\n      case ChatType.P2P_WITH_USER:\n        return [peerChatUrlString, RoleId.PROVIDER_ROLE_ID];\n        break;\n      case ChatType.SESSION:\n        return [reservationUrlString];\n      default:\n    }\n  }\n  isEndedSessionChat() {\n    return (\n      this.chatType == ChatType.SESSION &&\n      Session.isEnded(this.audience as Session)\n    );\n  }\n}\n","export default \"@font-face {\\n  font-family: myIranSans;\\n  src: url('IRANSans.ttf');\\n  font-weight: 400;\\n}\\n@font-face {\\n  font-family: myIranSans;\\n  src: url('IRANSans_Bold.ttf');\\n  font-weight: 700;\\n}\\n@font-face {\\n  font-family: myIranSans;\\n  src: url('IRANSans_Light.ttf');\\n  font-weight: 300;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_UltraLight.ttf');\\n  font-weight: 200;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Medium.ttf');\\n  font-weight: 500;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum).ttf');\\n  font-weight: 400;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Bold.ttf');\\n  font-weight: 700;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Light.ttf');\\n  font-weight: 300;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_UltraLight.ttf');\\n  font-weight: 200;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Medium.ttf');\\n  font-weight: 500;\\n}\\nion-title .avatar {\\n  width: 2.5rem;\\n  height: 2.5rem;\\n  border-radius: 50px;\\n  background-position: center center;\\n  background-size: cover;\\n  margin-left: 10px;\\n  margin-top: 2px;\\n}\\nion-title .online-status {\\n  padding-top: 4px;\\n  padding-left: 10px;\\n  line-height: 2px;\\n}\\nion-title .online-status ion-icon.online {\\n  color: lime;\\n}\\nion-title .online-status ion-icon.offline {\\n  color: gray;\\n}\\n.chat-content .input {\\n  align-self: end;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy90aGVtZS9mb250cy5zY3NzIiwic3JjL2FwcC9tZXNzYWdpbmcvbWVzc2VuZ2VyL21lc3Nlbmdlci5wYWdlLnNjc3MiLCJzcmMvdGhlbWUvY29tbW9uLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSx1QkFBQTtFQUNBLHdCQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBRENFO0VBQ0UsdUJBQUE7RUFDQSw2QkFBQTtFQUNBLGdCQUFBO0FDQ0o7QURDRTtFQUNFLHVCQUFBO0VBQ0EsOEJBQUE7RUFDQSxnQkFBQTtBQ0NKO0FEQ0U7RUFDRSw0QkFBQTtFQUNBLDBDQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBRENFO0VBQ0UsNEJBQUE7RUFDQSxzQ0FBQTtFQUNBLGdCQUFBO0FDQ0o7QURDRTtFQUNFLDRCQUFBO0VBQ0EsK0JBQUE7RUFDQSxnQkFBQTtBQ0NKO0FEQ0U7RUFDRSw0QkFBQTtFQUNBLG9DQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBRENFO0VBQ0UsNEJBQUE7RUFDQSxxQ0FBQTtFQUNBLGdCQUFBO0FDQ0o7QURDRTtFQUNFLDRCQUFBO0VBQ0EsMENBQUE7RUFDQSxnQkFBQTtBQ0NKO0FEQ0U7RUFDRSw0QkFBQTtFQUNBLHNDQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBQTlDRTtFQUNFLGFBQUE7RUFDQSxjQUFBO0VBQ0EsbUJBQUE7RUFDQSxrQ0FBQTtFQUNBLHNCQUFBO0VBQ0EsaUJBQUE7RUFDQSxlQUFBO0FBZ0RKO0FBOUNFO0VBQ0UsZ0JBQUE7RUFDQSxrQkFBQTtFQUNBLGdCQUFBO0FBZ0RKO0FBOUNNO0VBQ0UsV0FBQTtBQWdEUjtBQTlDTTtFQUNFLFdDRk87QURrRGY7QUF0Q0U7RUFDRSxlQUFBO0FBd0NKIiwiZmlsZSI6InNyYy9hcHAvbWVzc2FnaW5nL21lc3Nlbmdlci9tZXNzZW5nZXIucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiQGZvbnQtZmFjZSB7XG4gICAgZm9udC1mYW1pbHk6IG15SXJhblNhbnM7XG4gICAgc3JjOiB1cmwoJy4uL2Fzc2V0cy9mb250cy9JUkFOU2Fucy50dGYnKTtcbiAgICBmb250LXdlaWdodDogNDAwO1xuICB9XG4gIEBmb250LWZhY2Uge1xuICAgIGZvbnQtZmFtaWx5OiBteUlyYW5TYW5zO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnNfQm9sZC50dGYnKTtcbiAgICBmb250LXdlaWdodDogNzAwO1xuICB9XG4gIEBmb250LWZhY2Uge1xuICAgIGZvbnQtZmFtaWx5OiBteUlyYW5TYW5zO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnNfTGlnaHQudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDMwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX1VsdHJhTGlnaHQudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDIwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX01lZGl1bS50dGYnKTtcbiAgICBmb250LXdlaWdodDogNTAwO1xuICB9XG4gIEBmb250LWZhY2Uge1xuICAgIGZvbnQtZmFtaWx5OiBteUlyYW5TYW5zRmFOdW07XG4gICAgc3JjOiB1cmwoJy4uL2Fzc2V0cy9mb250cy9JUkFOU2FucyhGYU51bSkudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX0JvbGQudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDcwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX0xpZ2h0LnR0ZicpO1xuICAgIGZvbnQtd2VpZ2h0OiAzMDA7XG4gIH1cbiAgQGZvbnQtZmFjZSB7XG4gICAgZm9udC1mYW1pbHk6IG15SXJhblNhbnNGYU51bTtcbiAgICBzcmM6IHVybCgnLi4vYXNzZXRzL2ZvbnRzL0lSQU5TYW5zKEZhTnVtKV9VbHRyYUxpZ2h0LnR0ZicpO1xuICAgIGZvbnQtd2VpZ2h0OiAyMDA7XG4gIH1cbiAgQGZvbnQtZmFjZSB7XG4gICAgZm9udC1mYW1pbHk6IG15SXJhblNhbnNGYU51bTtcbiAgICBzcmM6IHVybCgnLi4vYXNzZXRzL2ZvbnRzL0lSQU5TYW5zKEZhTnVtKV9NZWRpdW0udHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgfSIsIkBpbXBvcnQgXCJzcmMvdGhlbWUvY29tbW9uLnNjc3NcIjtcblxuaW9uLXRpdGxlIHtcbiAgLmF2YXRhciB7XG4gICAgd2lkdGg6IDIuNXJlbTtcbiAgICBoZWlnaHQ6IDIuNXJlbTtcbiAgICBib3JkZXItcmFkaXVzOiA1MHB4O1xuICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlciBjZW50ZXI7XG4gICAgYmFja2dyb3VuZC1zaXplOiBjb3ZlcjtcbiAgICBtYXJnaW4tbGVmdDogMTBweDtcbiAgICBtYXJnaW4tdG9wOiAycHg7XG4gIH1cbiAgLm9ubGluZS1zdGF0dXMge1xuICAgIHBhZGRpbmctdG9wOiA0cHg7XG4gICAgcGFkZGluZy1sZWZ0OiAxMHB4O1xuICAgIGxpbmUtaGVpZ2h0OiAycHg7XG4gICAgaW9uLWljb24ge1xuICAgICAgJi5vbmxpbmUge1xuICAgICAgICBjb2xvcjogJG9ubGluZS1jb2xvcjtcbiAgICAgIH1cbiAgICAgICYub2ZmbGluZSB7XG4gICAgICAgIGNvbG9yOiAkb2ZmbGluZS1jb2xvcjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLm5hbWUtdGV4dCB7XG4gIH1cbiAgLnNlc3Npb24tc3RhdHVzIHtcbiAgfVxufVxuLmNoYXQtY29udGVudCB7XG4gIC5pbnB1dCB7XG4gICAgYWxpZ24tc2VsZjogZW5kO1xuICB9XG59XG5cbiIsIlxuQGltcG9ydCAnZm9udHMuc2Nzcyc7XG4kZm9udCA6IFwibXlJcmFuU2Fuc1wiO1xuJGZvbnROdW0gOiBcIm15SXJhblNhbnNGYU51bVwiO1xuJHByaW1hcnktY29sb3ItZGFyazogIzQ3OTY5YjtcbiRwcmltYXJ5LWNvbG9yLWxpZ2h0OiNhNWRhZGU7XG4kcHJpbWFyeS1jb2xvci14ZGFyazojMmM4MTg2O1xuJHByaW1hcnktY29sb3IteGxpZ2h0OiNkN2YzZjY7XG4kcHJpbWFyeS1jb2xvcjogIzcxYmNjMTtcbiRzZWNvbmRhcnktY29sb3ItZGFyazogI2NlMzIxYztcbiRzZWNvbmRhcnktY29sb3ItbGlnaHQ6I2ZlN2Y3MDtcbiRzZWNvbmRhcnktY29sb3IteGRhcms6I2EyMWQwYTtcbiRzZWNvbmRhcnktY29sb3IteGxpZ2h0OiNmZmExOTg7XG4kc2Vjb25kYXJ5LWNvbG9yOiAjZTY1ODQ0O1xuJHRlcnRpYXJ5LWNvbG9yOiM3MWNlOTk7XG4kcXVhdGVybmFyeS1jb2xvcjojZWViZDYwO1xuJGRhcmstdGV4dC1jb2xvcjojNGU0ZTRlO1xuJGxpZ2h0LXRleHQtY29sb3I6I2E1YTVhNTtcbiRvbmxpbmUtY29sb3I6bGltZTtcbiRvZmZsaW5lLWNvbG9yOmdyYXk7XG5AbWl4aW4gcm90YXRlKCRkZWdyZWVzKSB7XG4gICAgLXdlYmtpdC10cmFuc2Zvcm06IHJvdGF0ZSgkZGVncmVlcyk7XG4gICAgLW1vei10cmFuc2Zvcm06IHJvdGF0ZSgkZGVncmVlcyk7XG4gICAgLW1zLXRyYW5zZm9ybTogcm90YXRlKCRkZWdyZWVzKTtcbiAgICAtby10cmFuc2Zvcm06IHJvdGF0ZSgkZGVncmVlcyk7XG4gICAgdHJhbnNmb3JtOiByb3RhdGUoJGRlZ3JlZXMpO1xufVxuQG1peGluIGJveC1zaGFkb3coJGxlZnQsICR0b3AsICRyYWRpdXMsICRjb2xvcikge1xuXHRib3gtc2hhZG93OiAkbGVmdCAkdG9wICRyYWRpdXMgJGNvbG9yO1xuXHQtd2Via2l0LWJveC1zaGFkb3c6ICRsZWZ0ICR0b3AgJHJhZGl1cyAkY29sb3I7XG5cdC1tb3otYm94LXNoYWRvdzogJGxlZnQgJHRvcCAkcmFkaXVzICRjb2xvcjtcbn1cbkBtaXhpbiBib3gtc2hhZG93LWZ1bGwoJGxlZnQsICR0b3AsICRibHVyLCAkc3ByZWFkLCAkY29sb3IpIHtcblx0Ym94LXNoYWRvdzogJGxlZnQgJHRvcCAkYmx1ciAkc3ByZWFkICRjb2xvcjtcblx0LXdlYmtpdC1ib3gtc2hhZG93OiAkbGVmdCAkdG9wICRibHVyICRzcHJlYWQgJGNvbG9yO1xuXHQtbW96LWJveC1zaGFkb3c6ICRsZWZ0ICR0b3AgJGJsdXIgJHNwcmVhZCAkY29sb3I7XG59XG5AbWl4aW4gYm94LXNoYWRvdy1mdWxsLWluc2V0KCRsZWZ0LCAkdG9wLCAkYmx1ciwgJHNwcmVhZCwgJGNvbG9yKSB7XG5cdGJveC1zaGFkb3c6IGluc2V0ICRsZWZ0ICR0b3AgJGJsdXIgJHNwcmVhZCAkY29sb3I7XG5cdC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgJGxlZnQgJHRvcCAkYmx1ciAkc3ByZWFkICRjb2xvcjtcblx0LW1vei1ib3gtc2hhZG93OiBpbnNldCAkbGVmdCAkdG9wICRibHVyICRzcHJlYWQgJGNvbG9yO1xufVxuQG1peGluIGJvcmRlci1yYWRpdXMoJHJhZGl1cykge1xuXHRib3JkZXItcmFkaXVzOiAkcmFkaXVzO1xuXHQtd2Via2l0LWJvcmRlci1yYWRpdXM6ICRyYWRpdXM7XG4gICAgLW1vei1ib3JkZXItcmFkaXVzOiAkcmFkaXVzO1xuICAgIC0tYm9yZGVyLXJhZGl1czokcmFkaXVzO1xufVxuQG1peGluIHRyYW5zZm9ybSgkdHJhbnNmb3Jtcykge1xuXHQtd2Via2l0LXRyYW5zZm9ybTogJHRyYW5zZm9ybXM7XG5cdC1tb3otdHJhbnNmb3JtOiAkdHJhbnNmb3Jtcztcblx0LW1zLXRyYW5zZm9ybTogJHRyYW5zZm9ybXM7XG5cdHRyYW5zZm9ybTogJHRyYW5zZm9ybXM7XG59Il19 */\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { MessengerPage } from './messenger.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MessengerPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class MessengerPageRoutingModule {}\n","import { MessagingModule } from './../messaging/messaging.module';\nimport { CommonDeclarationsModule } from './../../common/common-declarations/common-declarations.module';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MessengerPageRoutingModule } from './messenger-routing.module';\n\nimport { MessengerPage } from './messenger.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    MessengerPageRoutingModule,\n    CommonDeclarationsModule,\n    MessagingModule\n  ],\n  declarations: [MessengerPage]\n})\nexport class MessengerPageModule {}\n"],"sourceRoot":"webpack:///"}