{"version":3,"sources":["webpack:///src/app/messaging/messenger/messenger.page.html","webpack:///src/app/messaging/messenger/messenger.page.ts","webpack:///src/app/messaging/messenger/messenger.page.scss","webpack:///src/app/messaging/messenger/messenger-routing.module.ts","webpack:///src/app/messaging/messenger/messenger.module.ts"],"names":["MessengerPage","sessionsManager","route","providerService","userService","ref","alert","env","imService","chatType","providerPerspective","chatTypeEnum","peerUser","isTyping","getAudience","handleNewMessage","handleTyping","messages","index","record","seq","content","scrollToBottom","event","getMessagesPage","item","isImage","parseInt","snapshot","params","type","id","sharedResource","P2P_WITH_PROVIDER","providerByUserIdShared","P2P_WITH_USER","userShared","SESSION","sessionShared","getUpdateNotifier","subscribe","result","audience","resource","user","name","getName","subtitle","provider","detectChanges","startPeer2PeerChat","request","sessionId","props","session","openedFromSessionChat","presentModal","pipe","isTypingSubject","messageAddedToStart","getScrollElement","then","el","scrollY","oldScrollHeight","scrollHeight","oldScrollTop","scrollTop","heightObservable","observer","heightIntervalHandle","setInterval","next","complete","height","clearInterval","newScrollTop","infiniteScroll","messageGotDirty","dirty","vitrualScroll","checkRange","messageAddedToEnd","noteReceived","noteRead","clearTimeout","scrollToBottomTimeOut","positionForItem","setTimeout","disabled","noMoreMessages","yes","reservationUrlString","peerChatUrlString","USER_ROLE_ID","PROVIDER_ROLE_ID","isEnded","selector","template","changeDetection","OnPush","routes","path","component","MessengerPageRoutingModule","imports","forChild","exports","MessengerPageModule","declarations"],"mappings":"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","file":"messaging-messenger-messenger-module-es5.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button menu=\\\"end\\\">\\n        <ion-icon name=\\\"menu-outline\\\"></ion-icon>\\n      </ion-menu-button>\\n    </ion-buttons>\\n    <ion-title *ngIf=\\\"(peerUser)\\\">\\n      <div class=\\\"row no-gutters\\\">\\n        <div class=\\\"col-auto\\\">\\n          <app-user-avatar\\n            class=\\\"primary-background\\\"\\n            [user]=\\\"peerUser\\\"\\n          ></app-user-avatar>\\n        </div>\\n        <div class=\\\"col d-flex flex-column justify-content-center\\\">\\n          <div class=\\\"row no-gutters\\\">\\n            <div class=\\\"col col-auto\\\">\\n              <ion-icon\\n                [ngClass]=\\\"this.sessionsManager.isUserOnline(peerUser)?'online':''\\\"\\n                [name]=\\\"this.env.ONLINE_ICON\\\"\\n                class=\\\"online-status\\\"\\n              ></ion-icon>\\n            </div>\\n            <span class=\\\"name-text\\\"> {{name}} </span>\\n          </div>\\n\\n          <small class=\\\"session-status\\\"> {{subtitle}} </small>\\n        </div>\\n      </div>\\n    </ion-title>\\n    <ion-buttons class=\\\"\\\" slot=\\\"end\\\">\\n      <ion-button\\n        *ngIf=\\\"chatType && chatType==chatTypeEnum.SESSION\\\"\\n        (click)=\\\"openSessionInfo()\\\"\\n      >\\n        <ion-icon name=\\\"settings-outline\\\"></ion-icon>\\n      </ion-button>\\n      <ion-back-button [defaultHref]=\\\"backUrl()\\\"></ion-back-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content #content>\\n  <div class=\\\"chat-content\\\" #chatContent>\\n    <ion-infinite-scroll\\n      threshold=\\\"0px\\\"\\n      (ionInfinite)=\\\"nextPage($event)\\\"\\n      position=\\\"top\\\"\\n    >\\n      <ion-infinite-scroll-content> </ion-infinite-scroll-content>\\n    </ion-infinite-scroll>\\n    <ion-virtual-scroll\\n      [items]=\\\"messages()\\\"\\n      [trackBy]=\\\"track\\\"\\n      [itemHeight]=\\\"itemHeight\\\"\\n    >\\n      <div class=\\\"row\\\" *virtualItem=\\\"let message\\\">\\n        <app-message-content\\n          class=\\\"col-12\\\"\\n          *ngIf=\\\"message\\\"\\n          [message]=\\\"message\\\"\\n        ></app-message-content>\\n      </div>\\n    </ion-virtual-scroll>\\n    <div class=\\\"row\\\" *ngIf=\\\"this.isTyping\\\">\\n      <app-typing-message class=\\\"col-12\\\"></app-typing-message>\\n    </div>\\n  </div>\\n</ion-content>\\n<app-send-message *ngIf=\\\"!isEndedSessionChat()\\\">\\n\\n</app-send-message>\";","import { RoleId } from \"./../../models/user\";\nimport { Observable } from \"rxjs\";\nimport { IMService } from \"src/app/services/im.service\";\nimport { EnvService } from \"src/app/services/env.service\";\nimport { SessionInfoComponent } from \"./../../common/session-info/session-info.component\";\nimport { AlertService } from \"src/app/services/alert.service\";\nimport { UserService } from \"src/app/services/user.service\";\nimport { ProviderService } from \"src/app/services/provider.service\";\nimport { User } from \"src/app/models/user\";\nimport { Provider } from \"src/app/models/provider\";\nimport { Session } from \"src/app/models/session\";\nimport { ActivatedRoute } from \"@angular/router\";\nimport {\n  SessionsManagerService,\n  ChatType,\n} from \"src/app/services/sessions-manager-service\";\nimport {\n  Component,\n  OnInit,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  ViewChild,\n} from \"@angular/core\";\nimport { UntilDestroy, untilDestroyed } from \"@ngneat/until-destroy\";\nimport { SharedResourceAsyncRequestBundle } from \"src/app/architecture/shared-resource-async-request-bundle\";\nimport { take, debounceTime, last } from \"rxjs/operators\";\nimport { IonVirtualScroll, IonInfiniteScroll } from \"@ionic/angular\";\n\n@UntilDestroy()\n@Component({\n  selector: \"app-messenger\",\n  templateUrl: \"./messenger.page.html\",\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  styleUrls: [\"./messenger.page.scss\"],\n})\nexport class MessengerPage implements OnInit {\n  @ViewChild(\"content\", { static: false }) private content;\n  @ViewChild(IonVirtualScroll, { static: false })\n  vitrualScroll: IonVirtualScroll;\n  @ViewChild(IonInfiniteScroll, { static: false })\n  infiniteScroll: IonInfiniteScroll;\n\n  audience: Session | Provider | User;\n  name: string;\n  subtitle: string;\n  chatType: ChatType = null;\n  providerPerspective: boolean = null;\n  chatTypeEnum = ChatType;\n  peerUser: User = null;\n  isTyping: boolean = false;\n\n  heightIntervalHandle;\n  scrollToBottomTimeOut;\n  constructor(\n    public sessionsManager: SessionsManagerService,\n    private route: ActivatedRoute,\n    private providerService: ProviderService,\n    private userService: UserService,\n    private ref: ChangeDetectorRef,\n    private alert: AlertService,\n    public env: EnvService,\n    public imService: IMService\n  ) {}\n\n  ngOnInit() {\n    this.getAudience();\n    this.handleNewMessage();\n    this.handleTyping();\n  }\n  messages() {\n    return this.imService.messages;\n  }\n  track(index, record) {\n    return record.seq;\n  }\n  scrollToBottom() {\n    this.content.scrollToBottom(300);\n  }\n  nextPage(event) {\n    this.imService.getMessagesPage();\n  }\n  itemHeight(item, index) {\n    if (item.isImage) {\n      return 213;\n    }\n\n    return 45;\n    return 40;\n  }\n  getAudience() {\n    this.chatType = parseInt(this.route.snapshot.params.type);\n    this.providerPerspective =\n      parseInt(this.route.snapshot.params.providerPerspective) == 1;\n    let id = parseInt(this.route.snapshot.params.id);\n    let sharedResource: SharedResourceAsyncRequestBundle<any, any> = null;\n\n    switch (this.chatType) {\n      case ChatType.P2P_WITH_PROVIDER:\n        sharedResource = this.providerService.providerByUserIdShared;\n        break;\n      case ChatType.P2P_WITH_USER:\n        sharedResource = this.userService.userShared;\n        break;\n      case ChatType.SESSION:\n        sharedResource = this.sessionsManager.sessionShared;\n      default:\n    }\n\n    sharedResource.getUpdateNotifier(this).subscribe((result) => {\n      this.audience = sharedResource.resource();\n      \n      switch (this.chatType) {\n        case ChatType.P2P_WITH_PROVIDER:\n          this.peerUser = (this.audience as Provider).user;\n          this.name = User.getName(this.peerUser);\n          this.subtitle = \"گفتگوی هماهنگی\";\n          break;\n        case ChatType.P2P_WITH_USER:\n          this.subtitle = \"گفتگوی هماهنگی\";\n          this.peerUser = this.audience as User;\n          this.name = User.getName(this.peerUser);\n          break;\n        case ChatType.SESSION:\n          this.subtitle = \"جلسه مشاوره: \";\n\n          if (this.providerPerspective) {\n            this.peerUser = (this.audience as Session).user;\n          } else {\n            this.peerUser = (this.audience as Session).provider.user;\n          }\n          this.name = User.getName(this.peerUser);\n          break;\n        default:\n      }\n      this.ref.detectChanges();\n      this.sessionsManager.startPeer2PeerChat(this.peerUser);\n    });\n\n    sharedResource.request(id);\n  }\n  openSessionInfo() {\n    let sessionId = (this.audience as Session).id;\n    let props = {\n      session: this.audience as Session,\n      providerPerspective: !this.providerPerspective,\n      openedFromSessionChat: true,\n    };\n    this.alert\n      .presentModal(SessionInfoComponent, props)\n      .pipe(take(1))\n      .subscribe();\n  }\n  handleTyping() {\n    this.imService.isTypingSubject\n      .pipe(untilDestroyed(this))\n      .subscribe((result) => {\n        this.isTyping = result;\n        this.ref.detectChanges();\n      });\n  }\n  handleNewMessage() {\n    this.imService.messageAddedToStart\n      .pipe(debounceTime(400), untilDestroyed(this))\n      .subscribe((index) => {\n        this.content.getScrollElement().then((el) => {\n          this.ref.detectChanges();\n          this.content.scrollY = false;\n          var oldScrollHeight = el.scrollHeight;\n          var oldScrollTop = el.scrollTop;\n          let heightObservable = new Observable((observer) => {\n            this.heightIntervalHandle = setInterval(() => {\n              if (el.scrollHeight != oldScrollHeight) {\n                observer.next(el.scrollHeight);\n                observer.complete();\n              }\n              oldScrollTop = el.scrollTop;\n            }, 50);\n          });\n          heightObservable.pipe(last()).subscribe((height) => {\n            clearInterval(this.heightIntervalHandle);\n            let newScrollTop =\n              oldScrollTop + ((height as number) - oldScrollHeight);\n            el.scrollTop = newScrollTop;\n            // this.content.scrollToPoint(null, newScrollTop, 0).then(()=>{\n            //   this.content.scrollY = true;\n            // });\n            this.content.scrollY = true;\n            this.infiniteScroll.complete();\n          });\n        });\n      });\n    this.imService.messageGotDirty\n      .pipe(untilDestroyed(this))\n      .subscribe((dirty) => {\n        this.vitrualScroll.checkRange(dirty);\n        //this.ref.detectChanges();\n      });\n    this.imService.messageAddedToEnd\n      .pipe(untilDestroyed(this))\n      .subscribe((index) => {\n        this.imService.noteReceived(this.imService.messages[index]);\n        this.imService.noteRead(this.imService.messages[index]);\n        clearTimeout(this.scrollToBottomTimeOut);\n        this.ref.detectChanges();\n        this.vitrualScroll.positionForItem(index).then((result) => {});\n        this.scrollToBottomTimeOut = setTimeout(() => {\n          this.scrollToBottom();\n          this.infiniteScroll.disabled = false;\n        }, 1000);\n      });\n    this.imService.noMoreMessages.subscribe((yes) => {\n      if (yes) {\n        this.infiniteScroll.complete();\n        this.infiniteScroll.disabled = true;\n      } else {\n        //this.infiniteScroll.disabled = false;\n      }\n    });\n  }\n  backUrl() {\n    let reservationUrlString = this.providerPerspective\n      ? \"pvd-reservations\"\n      : \"usr-reservations\";\n    let peerChatUrlString = 'peer-chats'; \n    switch (this.chatType) {\n      case ChatType.P2P_WITH_PROVIDER:\n        return [peerChatUrlString, RoleId.USER_ROLE_ID];\n        break;\n      case ChatType.P2P_WITH_USER:\n        return [peerChatUrlString, RoleId.PROVIDER_ROLE_ID];\n        break;\n      case ChatType.SESSION:\n        return [reservationUrlString];\n      default:\n    }\n  }\n  isEndedSessionChat() {\n    return (\n      this.chatType == ChatType.SESSION &&\n      Session.isEnded(this.audience as Session)\n    );\n  }\n}\n","export default \"@font-face {\\n  font-family: myIranSans;\\n  src: url('IRANSans.ttf');\\n  font-weight: 400;\\n}\\n@font-face {\\n  font-family: myIranSans;\\n  src: url('IRANSans_Bold.ttf');\\n  font-weight: 700;\\n}\\n@font-face {\\n  font-family: myIranSans;\\n  src: url('IRANSans_Light.ttf');\\n  font-weight: 300;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_UltraLight.ttf');\\n  font-weight: 200;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Medium.ttf');\\n  font-weight: 500;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum).ttf');\\n  font-weight: 400;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Bold.ttf');\\n  font-weight: 700;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Light.ttf');\\n  font-weight: 300;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_UltraLight.ttf');\\n  font-weight: 200;\\n}\\n@font-face {\\n  font-family: myIranSansFaNum;\\n  src: url('IRANSans(FaNum)_Medium.ttf');\\n  font-weight: 500;\\n}\\nion-title .avatar {\\n  width: 2.5rem;\\n  height: 2.5rem;\\n  border-radius: 50px;\\n  background-position: center center;\\n  background-size: cover;\\n  margin-left: 10px;\\n  margin-top: 2px;\\n}\\nion-title .online-status {\\n  padding-top: 4px;\\n  padding-left: 10px;\\n  line-height: 2px;\\n}\\nion-title .online-status ion-icon.online {\\n  color: lime;\\n}\\nion-title .online-status ion-icon.offline {\\n  color: gray;\\n}\\n.chat-content .input {\\n  align-self: end;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy90aGVtZS9mb250cy5zY3NzIiwic3JjL2FwcC9tZXNzYWdpbmcvbWVzc2VuZ2VyL21lc3Nlbmdlci5wYWdlLnNjc3MiLCJzcmMvdGhlbWUvY29tbW9uLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSx1QkFBQTtFQUNBLHdCQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBRENFO0VBQ0UsdUJBQUE7RUFDQSw2QkFBQTtFQUNBLGdCQUFBO0FDQ0o7QURDRTtFQUNFLHVCQUFBO0VBQ0EsOEJBQUE7RUFDQSxnQkFBQTtBQ0NKO0FEQ0U7RUFDRSw0QkFBQTtFQUNBLDBDQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBRENFO0VBQ0UsNEJBQUE7RUFDQSxzQ0FBQTtFQUNBLGdCQUFBO0FDQ0o7QURDRTtFQUNFLDRCQUFBO0VBQ0EsK0JBQUE7RUFDQSxnQkFBQTtBQ0NKO0FEQ0U7RUFDRSw0QkFBQTtFQUNBLG9DQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBRENFO0VBQ0UsNEJBQUE7RUFDQSxxQ0FBQTtFQUNBLGdCQUFBO0FDQ0o7QURDRTtFQUNFLDRCQUFBO0VBQ0EsMENBQUE7RUFDQSxnQkFBQTtBQ0NKO0FEQ0U7RUFDRSw0QkFBQTtFQUNBLHNDQUFBO0VBQ0EsZ0JBQUE7QUNDSjtBQTlDRTtFQUNFLGFBQUE7RUFDQSxjQUFBO0VBQ0EsbUJBQUE7RUFDQSxrQ0FBQTtFQUNBLHNCQUFBO0VBQ0EsaUJBQUE7RUFDQSxlQUFBO0FBZ0RKO0FBOUNFO0VBQ0UsZ0JBQUE7RUFDQSxrQkFBQTtFQUNBLGdCQUFBO0FBZ0RKO0FBOUNNO0VBQ0UsV0FBQTtBQWdEUjtBQTlDTTtFQUNFLFdDRk87QURrRGY7QUF0Q0U7RUFDRSxlQUFBO0FBd0NKIiwiZmlsZSI6InNyYy9hcHAvbWVzc2FnaW5nL21lc3Nlbmdlci9tZXNzZW5nZXIucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiQGZvbnQtZmFjZSB7XG4gICAgZm9udC1mYW1pbHk6IG15SXJhblNhbnM7XG4gICAgc3JjOiB1cmwoJy4uL2Fzc2V0cy9mb250cy9JUkFOU2Fucy50dGYnKTtcbiAgICBmb250LXdlaWdodDogNDAwO1xuICB9XG4gIEBmb250LWZhY2Uge1xuICAgIGZvbnQtZmFtaWx5OiBteUlyYW5TYW5zO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnNfQm9sZC50dGYnKTtcbiAgICBmb250LXdlaWdodDogNzAwO1xuICB9XG4gIEBmb250LWZhY2Uge1xuICAgIGZvbnQtZmFtaWx5OiBteUlyYW5TYW5zO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnNfTGlnaHQudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDMwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX1VsdHJhTGlnaHQudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDIwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX01lZGl1bS50dGYnKTtcbiAgICBmb250LXdlaWdodDogNTAwO1xuICB9XG4gIEBmb250LWZhY2Uge1xuICAgIGZvbnQtZmFtaWx5OiBteUlyYW5TYW5zRmFOdW07XG4gICAgc3JjOiB1cmwoJy4uL2Fzc2V0cy9mb250cy9JUkFOU2FucyhGYU51bSkudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX0JvbGQudHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDcwMDtcbiAgfVxuICBAZm9udC1mYWNlIHtcbiAgICBmb250LWZhbWlseTogbXlJcmFuU2Fuc0ZhTnVtO1xuICAgIHNyYzogdXJsKCcuLi9hc3NldHMvZm9udHMvSVJBTlNhbnMoRmFOdW0pX0xpZ2h0LnR0ZicpO1xuICAgIGZvbnQtd2VpZ2h0OiAzMDA7XG4gIH1cbiAgQGZvbnQtZmFjZSB7XG4gICAgZm9udC1mYW1pbHk6IG15SXJhblNhbnNGYU51bTtcbiAgICBzcmM6IHVybCgnLi4vYXNzZXRzL2ZvbnRzL0lSQU5TYW5zKEZhTnVtKV9VbHRyYUxpZ2h0LnR0ZicpO1xuICAgIGZvbnQtd2VpZ2h0OiAyMDA7XG4gIH1cbiAgQGZvbnQtZmFjZSB7XG4gICAgZm9udC1mYW1pbHk6IG15SXJhblNhbnNGYU51bTtcbiAgICBzcmM6IHVybCgnLi4vYXNzZXRzL2ZvbnRzL0lSQU5TYW5zKEZhTnVtKV9NZWRpdW0udHRmJyk7XG4gICAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgfSIsIkBpbXBvcnQgXCJzcmMvdGhlbWUvY29tbW9uLnNjc3NcIjtcblxuaW9uLXRpdGxlIHtcbiAgLmF2YXRhciB7XG4gICAgd2lkdGg6IDIuNXJlbTtcbiAgICBoZWlnaHQ6IDIuNXJlbTtcbiAgICBib3JkZXItcmFkaXVzOiA1MHB4O1xuICAgIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlciBjZW50ZXI7XG4gICAgYmFja2dyb3VuZC1zaXplOiBjb3ZlcjtcbiAgICBtYXJnaW4tbGVmdDogMTBweDtcbiAgICBtYXJnaW4tdG9wOiAycHg7XG4gIH1cbiAgLm9ubGluZS1zdGF0dXMge1xuICAgIHBhZGRpbmctdG9wOiA0cHg7XG4gICAgcGFkZGluZy1sZWZ0OiAxMHB4O1xuICAgIGxpbmUtaGVpZ2h0OiAycHg7XG4gICAgaW9uLWljb24ge1xuICAgICAgJi5vbmxpbmUge1xuICAgICAgICBjb2xvcjogJG9ubGluZS1jb2xvcjtcbiAgICAgIH1cbiAgICAgICYub2ZmbGluZSB7XG4gICAgICAgIGNvbG9yOiAkb2ZmbGluZS1jb2xvcjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLm5hbWUtdGV4dCB7XG4gIH1cbiAgLnNlc3Npb24tc3RhdHVzIHtcbiAgfVxufVxuLmNoYXQtY29udGVudCB7XG4gIC5pbnB1dCB7XG4gICAgYWxpZ24tc2VsZjogZW5kO1xuICB9XG59XG5cbiIsIlxuQGltcG9ydCAnZm9udHMuc2Nzcyc7XG4kZm9udCA6IFwibXlJcmFuU2Fuc1wiO1xuJGZvbnROdW0gOiBcIm15SXJhblNhbnNGYU51bVwiO1xuJHByaW1hcnktY29sb3ItZGFyazogIzQ3OTY5YjtcbiRwcmltYXJ5LWNvbG9yLWxpZ2h0OiNhNWRhZGU7XG4kcHJpbWFyeS1jb2xvci14ZGFyazojMmM4MTg2O1xuJHByaW1hcnktY29sb3IteGxpZ2h0OiNkN2YzZjY7XG4kcHJpbWFyeS1jb2xvcjogIzcxYmNjMTtcbiRzZWNvbmRhcnktY29sb3ItZGFyazogI2NlMzIxYztcbiRzZWNvbmRhcnktY29sb3ItbGlnaHQ6I2ZlN2Y3MDtcbiRzZWNvbmRhcnktY29sb3IteGRhcms6I2EyMWQwYTtcbiRzZWNvbmRhcnktY29sb3IteGxpZ2h0OiNmZmExOTg7XG4kc2Vjb25kYXJ5LWNvbG9yOiAjZTY1ODQ0O1xuJHRlcnRpYXJ5LWNvbG9yOiM3MWNlOTk7XG4kcXVhdGVybmFyeS1jb2xvcjojZWViZDYwO1xuJGRhcmstdGV4dC1jb2xvcjojNGU0ZTRlO1xuJGxpZ2h0LXRleHQtY29sb3I6I2E1YTVhNTtcbiRvbmxpbmUtY29sb3I6bGltZTtcbiRvZmZsaW5lLWNvbG9yOmdyYXk7XG5AbWl4aW4gcm90YXRlKCRkZWdyZWVzKSB7XG4gICAgLXdlYmtpdC10cmFuc2Zvcm06IHJvdGF0ZSgkZGVncmVlcyk7XG4gICAgLW1vei10cmFuc2Zvcm06IHJvdGF0ZSgkZGVncmVlcyk7XG4gICAgLW1zLXRyYW5zZm9ybTogcm90YXRlKCRkZWdyZWVzKTtcbiAgICAtby10cmFuc2Zvcm06IHJvdGF0ZSgkZGVncmVlcyk7XG4gICAgdHJhbnNmb3JtOiByb3RhdGUoJGRlZ3JlZXMpO1xufVxuQG1peGluIGJveC1zaGFkb3coJGxlZnQsICR0b3AsICRyYWRpdXMsICRjb2xvcikge1xuXHRib3gtc2hhZG93OiAkbGVmdCAkdG9wICRyYWRpdXMgJGNvbG9yO1xuXHQtd2Via2l0LWJveC1zaGFkb3c6ICRsZWZ0ICR0b3AgJHJhZGl1cyAkY29sb3I7XG5cdC1tb3otYm94LXNoYWRvdzogJGxlZnQgJHRvcCAkcmFkaXVzICRjb2xvcjtcbn1cbkBtaXhpbiBib3gtc2hhZG93LWZ1bGwoJGxlZnQsICR0b3AsICRibHVyLCAkc3ByZWFkLCAkY29sb3IpIHtcblx0Ym94LXNoYWRvdzogJGxlZnQgJHRvcCAkYmx1ciAkc3ByZWFkICRjb2xvcjtcblx0LXdlYmtpdC1ib3gtc2hhZG93OiAkbGVmdCAkdG9wICRibHVyICRzcHJlYWQgJGNvbG9yO1xuXHQtbW96LWJveC1zaGFkb3c6ICRsZWZ0ICR0b3AgJGJsdXIgJHNwcmVhZCAkY29sb3I7XG59XG5AbWl4aW4gYm94LXNoYWRvdy1mdWxsLWluc2V0KCRsZWZ0LCAkdG9wLCAkYmx1ciwgJHNwcmVhZCwgJGNvbG9yKSB7XG5cdGJveC1zaGFkb3c6IGluc2V0ICRsZWZ0ICR0b3AgJGJsdXIgJHNwcmVhZCAkY29sb3I7XG5cdC13ZWJraXQtYm94LXNoYWRvdzogaW5zZXQgJGxlZnQgJHRvcCAkYmx1ciAkc3ByZWFkICRjb2xvcjtcblx0LW1vei1ib3gtc2hhZG93OiBpbnNldCAkbGVmdCAkdG9wICRibHVyICRzcHJlYWQgJGNvbG9yO1xufVxuQG1peGluIGJvcmRlci1yYWRpdXMoJHJhZGl1cykge1xuXHRib3JkZXItcmFkaXVzOiAkcmFkaXVzO1xuXHQtd2Via2l0LWJvcmRlci1yYWRpdXM6ICRyYWRpdXM7XG4gICAgLW1vei1ib3JkZXItcmFkaXVzOiAkcmFkaXVzO1xuICAgIC0tYm9yZGVyLXJhZGl1czokcmFkaXVzO1xufVxuQG1peGluIHRyYW5zZm9ybSgkdHJhbnNmb3Jtcykge1xuXHQtd2Via2l0LXRyYW5zZm9ybTogJHRyYW5zZm9ybXM7XG5cdC1tb3otdHJhbnNmb3JtOiAkdHJhbnNmb3Jtcztcblx0LW1zLXRyYW5zZm9ybTogJHRyYW5zZm9ybXM7XG5cdHRyYW5zZm9ybTogJHRyYW5zZm9ybXM7XG59Il19 */\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { MessengerPage } from './messenger.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MessengerPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class MessengerPageRoutingModule {}\n","import { MessagingModule } from './../messaging/messaging.module';\nimport { CommonDeclarationsModule } from './../../common/common-declarations/common-declarations.module';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MessengerPageRoutingModule } from './messenger-routing.module';\n\nimport { MessengerPage } from './messenger.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    MessengerPageRoutingModule,\n    CommonDeclarationsModule,\n    MessagingModule\n  ],\n  declarations: [MessengerPage]\n})\nexport class MessengerPageModule {}\n"]}